<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Skill Difficulty Quiz</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin-top: 50px;
      }
      .button {
        display: inline-block;
        padding: 10px 20px;
        margin: 10px;
        font-size: 18px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        background-color: #f0f0f0;
        transition: background-color 0.3s;
        width: 80px; /* Set a fixed width for all buttons */
        text-align: center; /* Ensure the text is centered inside the button */
      }
      .button:hover {
        background-color: #e0e0e0;
      }
      .correct {
        background-color: green !important;
        color: white;
      }
      .incorrect {
        background-color: #d1a6a6 !important;
        color: white;
        pointer-events: none;
      }
      .score {
        font-size: 20px;
        margin-top: 20px;
      }
      .checkbox {
        margin: 10px;
      }
      .timer {
        font-size: 24px;
        margin-top: 20px;
      }
      .times-list {
        margin-top: 20px;
        font-size: 16px;
      }

      /* Add the jitter animation */
      @keyframes jitter {
        0% {
          transform: translateY(0);
        }
        25% {
          transform: translateY(2px);
        }
        50% {
          transform: translateY(-2px);
        }
        75% {
          transform: translateY(1px);
        }
        100% {
          transform: translateY(0);
        }
      }

      /* Apply the jitter effect to the body */
      .jitter {
        animation: jitter 0.5s ease-in-out;
      }
    </style>
  </head>
  <body>
    <h1>Skill Difficulty Quiz</h1>
    <div>
      <label class="checkbox">
        <input type="checkbox" id="singlesCheckbox" checked /> Singles
      </label>
      <label class="checkbox">
        <input type="checkbox" id="doublesCheckbox" /> Doubles
      </label>
      <label class="checkbox">
        <input type="checkbox" id="triplesCheckbox" /> Triples
      </label>
      <label class="checkbox">
        <input type="checkbox" id="quadsCheckbox" /> Quadruples
      </label>
      <label class="checkbox">
        <input type="checkbox" id="speedModeCheckbox" /> Speed Mode
      </label>
    </div>

    <h2 id="key"></h2>

    <div id="buttons"></div>

    <div class="score">
      <p>Correct: <span id="correctScore">0</span></p>
      <p>Incorrect: <span id="incorrectScore">0</span></p>
    </div>

    <div class="timer">
      Time to Correct Answer: <span id="timerDisplay">0.00</span> seconds
    </div>

    <div class="times-list">Last 5 Times: <span id="lastTimes"></span></div>

    <div class="average">
      Average Time: <span id="averageTime">X.XX</span> seconds
    </div>

    <script>
      const skillsDifficulty_Singles = {
        "4 0 o": 0.5,
        "4 0 <": 0.6,
        "4 0 /": 0.6,
        "4 1 o": 0.6,
        "4 1 <": 0.6,
        "4 1 /": 0.6,
        "4 2 /": 0.7,
        "4 3 /": 0.8,
        "4 4 /": 0.9,
        "4 5 /": 1.0,
        "4 6 /": 1.1,
        "4 7 /": 1.2,
        "4 8 /": 1.3,
        "4 9 /": 1.4,
      };

      const skillsDifficulty_Doubles = {
        "8 00 o": 1.1,
        "8 00 <": 1.3,
        "8 00 /": 1.3,
        "8 01 o": 1.1,
        "8 01 <": 1.3,
        "8 01 /": 1.3,
        "8 03 o": 1.3,
        "8 03 <": 1.5,
        "8 11 o": 1.3,
        "8 11 <": 1.5,
      };

      const skillsDifficulty_Triples = {
        "12 000 o": 1.8,
        "12 000 <": 2.1,
        "12 000 /": 2.1,
        "12 001 o": 1.7,
        "12 001 <": 2.0,
        "12 003 o": 2.1,
        "12 003 <": 2.4,
        "12 021 o": 2.1,
        "12 021 <": 2.4,
        "12 023 o": 2.7,
        "12 023 <": 3.0,
        "12 101 o": 2.0,
        "12 101 <": 2.3,
        "12 103 o": 2.6,
        "12 103 <": 2.9,
        "12 121 o": 2.6,
        "12 121 <": 2.9,
        "12 122 o": 3.2,
        "12 121 <": 2.9,
        "12 222 o": 3.2,
        "12 222 /": 3.5,
        "12 221 o": 2.7,
        "12 221 <": 3.0,
        "12 201 o": 2.1,
        "12 201 <": 2.4,
        "12 203 o": 2.7,
        "12 203 <": 3.0,
        "12 303 o": 3.2,
        "12 303 <": 3.5,
      };

      const skillsDifficulty_Quads = {
        "16 0001 o": 2.5,
        "16 0001 <": 2.9,
        "16 0003 o": 3.1,
        "16 0003 <": 3.5,
        "16 1001 o": 3.1,
        "16 1001 <": 3.5,
        "16 1003 o": 3.7,
        "16 1003 <": 4.1,
      };

      let correctScore = 0;
      let incorrectScore = 0;
      let timesToCorrectAnswer = [];
      let timer;
      let startTime;
      let isFirstIteration = true;
      let isSpeedMode = false;

      function getRandomKeyFromSelectedMaps() {
        const selectedMaps = [];

        if (document.getElementById("singlesCheckbox").checked) {
          selectedMaps.push(skillsDifficulty_Singles);
        }
        if (document.getElementById("doublesCheckbox").checked) {
          selectedMaps.push(skillsDifficulty_Doubles);
        }
        if (document.getElementById("triplesCheckbox").checked) {
          selectedMaps.push(skillsDifficulty_Triples);
        }
        if (document.getElementById("quadsCheckbox").checked) {
          selectedMaps.push(skillsDifficulty_Quads);
        }

        if (selectedMaps.length === 0) {
          alert("Please select at least one category.");
          return null;
        }

        const randomMap =
          selectedMaps[Math.floor(Math.random() * selectedMaps.length)];
        return getRandomKey(randomMap);
      }

      function getRandomKey(obj) {
        const keys = Object.keys(obj);
        return keys[Math.floor(Math.random() * keys.length)];
      }

      function generateOptions(correctValue) {
        const options = new Set([correctValue]);
        while (options.size < 3) {
          const randomValue = parseFloat(
            (correctValue + (Math.random() * 0.4 - 0.2)).toFixed(1)
          );
          options.add(randomValue);
        }
        return Array.from(options).sort(() => Math.random() - 0.5);
      }

      function updateScoreBoard() {
        document.getElementById("correctScore").textContent = correctScore;
        document.getElementById("incorrectScore").textContent = incorrectScore;
      }

      function disableAllButtons() {
        const buttons = document.querySelectorAll(".button");
        buttons.forEach((button) => {
          button.disabled = true;
        });
      }

      function startTimer() {
        startTime = Date.now();
        timer = setInterval(function () {
          const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
          document.getElementById("timerDisplay").textContent = elapsed;
        }, 100);
      }

      function stopTimer() {
        clearInterval(timer);
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);

        if (!isFirstIteration) {
          timesToCorrectAnswer.push(parseFloat(elapsed));
          if (timesToCorrectAnswer.length > 5) {
            timesToCorrectAnswer.shift();
          }
        }
        updateLastTimesDisplay();
        updateAverageTime();

        // Only trigger jitter if the user answers in less than 1 second
        if (parseFloat(elapsed) < 1) {
          console.log(elapsed);
          document.body.classList.add("jitter");
          setTimeout(() => {
            document.body.classList.remove("jitter");
          }, 250); // Duration of the jitter animation
        }
      }

      function updateLastTimesDisplay() {
        document.getElementById("lastTimes").textContent = timesToCorrectAnswer
          .map((time) => time.toFixed(2))
          .join(", ");
      }

      function updateAverageTime() {
        if (timesToCorrectAnswer.length > 0) {
          const average = (
            timesToCorrectAnswer.reduce((sum, time) => sum + time, 0) /
            timesToCorrectAnswer.length
          ).toFixed(2);
          document.getElementById("averageTime").textContent = average;
        }
      }

      function renderQuestion() {
        const key = getRandomKeyFromSelectedMaps();
        if (!key) return;

        const selectedMaps = [];
        if (document.getElementById("singlesCheckbox").checked) {
          selectedMaps.push(skillsDifficulty_Singles);
        }
        if (document.getElementById("doublesCheckbox").checked) {
          selectedMaps.push(skillsDifficulty_Doubles);
        }
        if (document.getElementById("triplesCheckbox").checked) {
          selectedMaps.push(skillsDifficulty_Triples);
        }
        if (document.getElementById("quadsCheckbox").checked) {
          selectedMaps.push(skillsDifficulty_Quads);
        }

        const mapContainingKey = selectedMaps.find((map) => key in map);
        const correctValue = mapContainingKey[key];
        const options = generateOptions(correctValue);

        document.getElementById("key").textContent = key;

        const buttonsDiv = document.getElementById("buttons");
        buttonsDiv.innerHTML = ""; // Clear previous buttons
        options.forEach((option) => {
          const button = document.createElement("button");
          button.classList.add("button");
          button.textContent = option;
          button.onclick = () => {
            if (option === correctValue) {
              button.classList.add("correct");
              correctScore++;
              disableAllButtons();
              stopTimer();

              // If speed mode is off, wait for a second before next question
              if (!isSpeedMode) {
                setTimeout(renderQuestion, 1000); // Wait a second before showing the next question
              } else {
                renderQuestion();
              }
              isFirstIteration = false;
            } else {
              button.classList.add("incorrect");
              incorrectScore++;
            }
            updateScoreBoard();
          };
          buttonsDiv.appendChild(button);
        });

        if (!isFirstIteration) {
          startTimer();
        }
      }

      // Listen for changes in the speed mode checkbox
      document
        .getElementById("speedModeCheckbox")
        .addEventListener("change", (e) => {
          isSpeedMode = e.target.checked;
        });

      document
        .querySelectorAll('input[type="checkbox"]')
        .forEach((checkbox) => {
          checkbox.addEventListener("change", renderQuestion);
        });

      renderQuestion(); // Start the first question
    </script>
  </body>
</html>
